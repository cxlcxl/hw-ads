(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cb653d0e"],{1863:function(e,t,n){},2934:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"p",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return s})),n.d(t,"i",(function(){return c})),n.d(t,"j",(function(){return d})),n.d(t,"l",(function(){return m})),n.d(t,"k",(function(){return p})),n.d(t,"m",(function(){return f})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return _})),n.d(t,"o",(function(){return g})),n.d(t,"n",(function(){return j}));var o=n("b775");function r(){return Object(o["a"])({url:"/regions",method:"get"})}function a(){return Object(o["a"])({url:"/settings/version",method:"get"})}function i(){return Object(o["a"])({url:"/region/area",method:"get"})}function l(e){return Object(o["a"])({url:"/region/country",method:"get",params:e})}function u(e){return Object(o["a"])({url:"/region",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/region/area-set",method:"post",data:e})}function c(){return Object(o["a"])({url:"/settings/cron",method:"get"})}function d(e){return Object(o["a"])({url:"/settings/cron/"+e,method:"get"})}function m(e,t){return Object(o["a"])({url:"/settings/cron/"+t,method:"post",data:e})}function p(e){return Object(o["a"])({url:"/settings/cron/schedule",method:"post",data:e})}function f(e){return Object(o["a"])({url:"/settings/configs",method:"get",params:e})}function b(e){return Object(o["a"])({url:"/settings/config",method:"post",data:e})}function h(e){return Object(o["a"])({url:"/settings/config/"+e,method:"get"})}function _(e,t){return Object(o["a"])({url:"/settings/config/"+t,method:"post",data:e})}function g(e){return Object(o["a"])({url:"/settings/log",method:"post",data:e})}var j="https://hiads.mobgi.cc/api/settings/log/"},5723:function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return u})),n.d(t,"j",(function(){return s})),n.d(t,"k",(function(){return c})),n.d(t,"g",(function(){return d})),n.d(t,"f",(function(){return m})),n.d(t,"i",(function(){return p})),n.d(t,"h",(function(){return f}));var o=n("b775");function r(e){return Object(o["a"])({url:"/account/update",method:"post",data:e})}function a(e){return Object(o["a"])({url:"/account/create",method:"post",data:e})}function i(e){return Object(o["a"])({url:"/account/list",method:"get",params:e})}function l(e){return Object(o["a"])({url:"/account/"+e,method:"get"})}function u(e){return Object(o["a"])({url:"/account/auth",method:"get",params:{id:e}})}function s(e){return Object(o["a"])({url:"/account/refresh/"+e,method:"post"})}function c(e){return Object(o["a"])({url:"/account/search",method:"get",params:{account_name:e}})}function d(){return Object(o["a"])({url:"/account/default",method:"get"})}function m(){return Object(o["a"])({url:"/account/all",method:"get"})}function p(e){return Object(o["a"])({url:"/account/parents",method:"get",params:e})}function f(e){return Object(o["a"])({url:"/account/token",method:"post",data:e})}},"68a0":function(e,t,n){"use strict";n("1863")},"80f8":function(e,t,n){},aa98:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{staticStyle:{"font-weight":"500","margin-bottom":"10px",color:"#909399"},attrs:{span:24}},[n("p",{staticClass:"text-error"},[e._v("* 后台总调度任务每 5 分钟会刷新写入规则，修改规则后一般 6 分钟内生效")]),n("p",[e._v("“下一次调度日期” 按需设置「无日期属性的调度任务可以无视」")])]),n("el-col",{attrs:{span:24}},[n("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.getCronList}},[e._v("刷新列表")])],1),n("el-col",{attrs:{span:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadings.pageLoading,expression:"loadings.pageLoading"}],staticStyle:{"margin-top":"15px"},attrs:{data:e.cronList.list,"highlight-current-row":"",stripe:"",border:"",size:"mini"}},[n("el-table-column",{attrs:{prop:"api_module",label:"调度模块",width:"268"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.cronList.api_modules[t.row.api_module]))]}}])}),n("el-table-column",{attrs:{prop:"stat_day",label:"下一次调度日期",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.stat_day,"{y}-{m}-{d}")))]}}])}),n("el-table-column",{attrs:{prop:"job_schedule",label:"调度周期",width:"110"}}),n("el-table-column",{attrs:{prop:"pause_rule",label:"停止调度规则",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:{"text-error":-1===t.row.pause_rule,"text-success":-1!==t.row.pause_rule}},[e._v(" "+e._s(e.cronList.pause_rules[t.row.pause_rule])+" ")])]}}])}),n("el-table-column",{attrs:{prop:"version",label:"版本",width:"70",align:"center"}}),n("el-table-column",{attrs:{prop:"remark",label:"备注"}}),n("el-table-column",{attrs:{prop:"order_by",label:"排序",width:"70",align:"center"}}),n("el-table-column",{attrs:{prop:"last_schedule",label:"最后调度完成时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.last_schedule)))]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button-group",{staticClass:"table-operate"},[n("el-button",{attrs:{type:"primary",plain:""},nativeOn:{click:function(n){return n.preventDefault(),e.editRow(t.row)}}},[e._v("编辑")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cronList.handler_jobs.includes(t.row.api_module),expression:"cronList.handler_jobs.includes(scope.row.api_module)"}],attrs:{plain:""},nativeOn:{click:function(n){return n.preventDefault(),e.scheduleRow(t.row)}}},[e._v("调度 ")])],1)]}}])})],1)],1),n("cron-update",{ref:"cronUpdate",attrs:{"api-modules":e.cronList.api_modules,"pause-rules":e.cronList.pause_rules},on:{success:e.getCronList}}),n("cron-schedule",{ref:"cronSchedule",attrs:{"api-modules":e.cronList.api_modules,"pause-rules":e.cronList.handler_pause_rules}})],1)},r=[],a=n("2934"),i=n("ed08"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DialogPanel",{attrs:{visible:e.visible,title:"调度规则修改",width:"430px","confirm-text":"保存","confirm-loading":e.loading},on:{confirm:e.confirm,cancel:e.cancel}},[n("el-form",{ref:"jobForm",attrs:{size:"mini","label-width":"120px",rules:e.rules,model:e.jobForm}},[n("el-form-item",{attrs:{label:"调度模块"}},[n("el-input",{attrs:{value:e.ApiModules[e.jobForm.api_module],disabled:""}})],1),n("el-form-item",{attrs:{label:"当前版本"}},[n("el-input",{attrs:{value:e.jobForm.version,disabled:""}})],1),n("el-form-item",{attrs:{label:"下次调度日期",prop:"stat_day"}},[n("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1,"picker-options":e.pickerOptions},model:{value:e.jobForm.stat_day,callback:function(t){e.$set(e.jobForm,"stat_day",t)},expression:"jobForm.stat_day"}})],1),n("el-form-item",{attrs:{label:"停止调度规则",prop:"pause_rule"}},[n("el-select",{model:{value:e.jobForm.pause_rule,callback:function(t){e.$set(e.jobForm,"pause_rule",t)},expression:"jobForm.pause_rule"}},e._l(e.PauseRules,(function(e,t){return n("el-option",{key:t,attrs:{label:e,value:Number(t)}})})),1)],1),n("el-form-item",{attrs:{label:"调度周期",prop:"job_schedule"}},[n("el-input",{attrs:{placeholder:"* * * * * [分/时/日/月/周]"},model:{value:e.jobForm.job_schedule,callback:function(t){e.$set(e.jobForm,"job_schedule",t)},expression:"jobForm.job_schedule"}}),n("p",{staticClass:"schedule"},[n("span",{staticClass:"text-error"},[e._v(" * 仅支持 Crontab 表达式和 "),n("code",[e._v("robfig/cron")]),e._v(" 包的规则 ["),n("a",{attrs:{href:"https://cron.qqe2.com/",target:"_blank"}},[e._v("Crontab 参考")]),e._v(","),n("a",{attrs:{href:"https://pkg.go.dev/github.com/robfig/cron",target:"_blank"}},[e._v("包规则参考")]),e._v("] ")])])],1),n("el-form-item",{attrs:{label:"排序",prop:"order_by"}},[n("el-input-number",{attrs:{min:1,max:99},model:{value:e.jobForm.order_by,callback:function(t){e.$set(e.jobForm,"order_by",t)},expression:"jobForm.order_by"}})],1),n("el-form-item",{attrs:{label:"备注",prop:"remark"}},[n("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.jobForm.remark,callback:function(t){e.$set(e.jobForm,"remark",t)},expression:"jobForm.remark"}})],1)],1)],1)},u=[],s=n("d4fd"),c={name:"SettingsCronCreate",components:{DialogPanel:s["a"]},props:{ApiModules:{type:Object,required:!0},PauseRules:{type:Object,required:!0}},data:function(){return{visible:!1,loading:!1,job_id:0,jobForm:{api_module:"",job_schedule:"",order_by:99,pause_rule:0,remark:"",stat_day:"",version:1},rules:{stat_day:{required:!0,message:"调度日期必填"},job_schedule:{required:!0,message:"调度周期必填"},pause_rule:{required:!0,message:"停止调度规则必选"},order_by:{required:!0,message:"排序必填"}},pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]}}},methods:{setDefault:function(e){var t=this;Object(a["j"])(e).then((function(n){t.visible=!0,t.job_id=e,t.jobForm=n.data,t.jobForm.stat_day=Object(i["c"])(t.jobForm.stat_day,"{y}-{m}-{d}")})).catch((function(e){t.$message.error(e)}))},confirm:function(){var e=this;this.$refs.jobForm.validate((function(t){if(!t)return!1;e.loading=!0,Object(a["l"])(e.jobForm,e.job_id).then((function(t){e.loading=!1,e.$message.success("修改成功"),e.$emit("success"),e.cancel()})).catch((function(t){e.loading=!1}))}))},cancel:function(){this.visible=!1}}},d=c,m=(n("68a0"),n("cba8")),p=Object(m["a"])(d,l,u,!1,null,null,null),f=p.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DialogPanel",{attrs:{visible:e.visible,title:"调度任务",width:"400px","confirm-text":"立即调度","confirm-loading":e.loading},on:{confirm:e.confirm,cancel:e.cancel}},[n("el-form",{ref:"jobForm",attrs:{size:"mini","label-width":"120px",rules:e.rules,model:e.jobForm}},[n("el-form-item",{attrs:{label:"调度模块"}},[n("el-input",{attrs:{value:e.ApiModules[e.jobForm.api_module],disabled:""}})],1),n("el-form-item",{attrs:{label:"调度日期",prop:"stat_day"}},[n("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1,"picker-options":e.pickerOptions},model:{value:e.jobForm.stat_day,callback:function(t){e.$set(e.jobForm,"stat_day",t)},expression:"jobForm.stat_day"}})],1),n("el-form-item",{attrs:{label:"停止调度规则",prop:"pause_rule"}},[n("el-select",{staticStyle:{width:"100%"},model:{value:e.jobForm.pause_rule,callback:function(t){e.$set(e.jobForm,"pause_rule",t)},expression:"jobForm.pause_rule"}},e._l(e.PauseRules,(function(e,t){return n("el-option",{key:t,attrs:{label:e,value:Number(t)}})})),1)],1),n("el-form-item",{attrs:{label:"调度单个账户",prop:"account_id"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"账户选择"},model:{value:e.jobForm.account_id,callback:function(t){e.$set(e.jobForm,"account_id",t)},expression:"jobForm.account_id"}},[n("el-option",{key:0,attrs:{label:"全部",value:0}}),e._l(e.accounts,(function(t){return n("el-option",{key:t.id,attrs:{label:e._f("nameFilter")(t.account_name,t.account_type),value:t.id}})}))],2)],1)],1)],1)},h=[],_=(n("4582"),n("5723")),g=n("cf0b"),j={name:"SettingsCronSchedule",components:{DialogPanel:s["a"]},props:{ApiModules:{type:Object,required:!0},PauseRules:{type:Object,required:!0}},data:function(){return{visible:!1,loading:!1,jobForm:{api_module:"",pause_rule:0,account_id:0,stat_day:""},rules:{stat_day:{required:!0,message:"调度日期必填"},pause_rule:{required:!0,message:"停止调度规则必选"}},accounts:[],pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]}}},filters:{nameFilter:function(e,t){return Number(t)===g["a"].AccountTypeAds?"[变现] "+e:"[投放] "+e}},methods:{setDefault:function(e){var t=this;Object(_["f"])().then((function(n){t.accounts=n.data,t.jobForm.api_module=e,t.visible=!0})).catch((function(){}))},confirm:function(){var e=this;this.$refs.jobForm.validate((function(t){if(!t)return!1;e.$confirm("此调度可能需要较长时间, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(a["k"])(e.jobForm).then((function(){e.$message.info("后台设置调度成功，刷新列表以最后调度完成时间为准"),e.loading=!1,e.visible=!1})).catch((function(t){e.loading=!1}))})).catch((function(){}))}))},cancel:function(){this.visible=!1}}},v=j,y=Object(m["a"])(v,b,h,!1,null,null,null),w=y.exports,k={name:"Cron",components:{CronUpdate:f,CronSchedule:w},data:function(){return{loadings:{pageLoading:!1},cronList:{list:[],pause_rules:{},handler_pause_rules:{},api_modules:{},handler_jobs:[]}}},computed:{},mounted:function(){this.getCronList()},filters:{timeFormat:function(e,t){return Object(i["c"])(e,t)}},methods:{getCronList:function(){var e=this;this.loadings.pageLoading=!0,Object(a["i"])().then((function(t){e.cronList.list=t.data.list,e.cronList.pause_rules=t.data.pause_rules,e.cronList.api_modules=t.data.api_modules,e.cronList.handler_jobs=t.data.handler_jobs,e.cronList.handler_pause_rules=t.data.handler_pause_rules,e.loadings.pageLoading=!1})).catch((function(){e.loadings.pageLoading=!1}))},editRow:function(e){this.$refs.cronUpdate.setDefault(e.id)},scheduleRow:function(e){this.$refs.cronSchedule.setDefault(e.api_module)}}},O=k,F=Object(m["a"])(O,o,r,!1,null,null,null);t["default"]=F.exports},b9c3:function(e,t,n){"use strict";n("80f8")},cf0b:function(e,t,n){"use strict";var o={AccountTypeMarket:1,AccountTypeAds:2,ReportGranularity:[{name:"按日期",key:"date"},{name:"按整体",key:"all"}]};t["a"]=o},d4fd:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{title:e.title,visible:e.visible,width:e.width,"append-to-body":"","modal-append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[e._t("default"),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.confirmLoading,icon:"el-icon-close"},on:{click:e.handleCancel}},[e._v("取消")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.confirmText,expression:"confirmText"}],attrs:{type:"primary",icon:"el-icon-check",loading:e.confirmLoading},on:{click:e.handleConfirm}},[e._v(e._s(e.confirmText))]),e._t("operate")],2)],2)},r=[],a={props:{confirmText:{default:"",type:String},title:{default:"",type:String},width:{default:"600px",type:String},confirmLoading:{default:!1,type:Boolean},visible:{default:!1,type:Boolean}},methods:{handleCancel:function(){this.$emit("cancel")},handleConfirm:function(){this.$emit("confirm")}}},i=a,l=(n("b9c3"),n("cba8")),u=Object(l["a"])(i,o,r,!1,null,null,null);t["a"]=u.exports}}]);