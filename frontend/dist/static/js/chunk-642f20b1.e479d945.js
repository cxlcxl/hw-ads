(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-642f20b1"],{1863:function(e,t,o){},2934:function(e,t,o){"use strict";o.d(t,"h",(function(){return n})),o.d(t,"n",(function(){return a})),o.d(t,"d",(function(){return l})),o.d(t,"e",(function(){return i})),o.d(t,"g",(function(){return s})),o.d(t,"f",(function(){return u})),o.d(t,"i",(function(){return c})),o.d(t,"j",(function(){return d})),o.d(t,"l",(function(){return p})),o.d(t,"k",(function(){return m})),o.d(t,"m",(function(){return f})),o.d(t,"a",(function(){return b})),o.d(t,"b",(function(){return _})),o.d(t,"c",(function(){return h}));var r=o("b775");function n(){return Object(r["a"])({url:"/regions",method:"get"})}function a(){return Object(r["a"])({url:"/settings/version",method:"get"})}function l(){return Object(r["a"])({url:"/region/area",method:"get"})}function i(e){return Object(r["a"])({url:"/region/country",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/region",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/region/area-set",method:"post",data:e})}function c(){return Object(r["a"])({url:"/settings/cron",method:"get"})}function d(e){return Object(r["a"])({url:"/settings/cron/"+e,method:"get"})}function p(e,t){return Object(r["a"])({url:"/settings/cron/"+t,method:"post",data:e})}function m(e){return Object(r["a"])({url:"/settings/cron/schedule",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/settings/configs",method:"get",params:e})}function b(e){return Object(r["a"])({url:"/settings/config",method:"post",data:e})}function _(e){return Object(r["a"])({url:"/settings/config/"+e,method:"get"})}function h(e,t){return Object(r["a"])({url:"/settings/config/"+t,method:"post",data:e})}},"68a0":function(e,t,o){"use strict";o("1863")},"80f8":function(e,t,o){},aa98:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-row",[o("el-col",{staticStyle:{"font-weight":"500","margin-bottom":"10px",color:"#909399"},attrs:{span:24}},[o("p",{staticClass:"text-error"},[e._v("* 后台总调度任务每 5 分钟会刷新写入规则，修改规则后一般 6 分钟内生效")]),o("p",[e._v("“下一次调度日期” 按需设置「无日期属性的调度任务可以无视」")])]),o("el-col",{attrs:{span:24}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.getCronList}},[e._v("刷新列表")])],1),o("el-col",{attrs:{span:24}},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadings.pageLoading,expression:"loadings.pageLoading"}],staticStyle:{"margin-top":"15px"},attrs:{data:e.cronList.list,"highlight-current-row":"",stripe:"",border:"",size:"mini"}},[o("el-table-column",{attrs:{prop:"api_module",label:"调度模块",width:"268"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.cronList.api_modules[t.row.api_module]))]}}])}),o("el-table-column",{attrs:{prop:"stat_day",label:"下一次调度日期",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.stat_day,"{y}-{m}-{d}")))]}}])}),o("el-table-column",{attrs:{prop:"job_schedule",label:"调度周期",width:"110"}}),o("el-table-column",{attrs:{prop:"pause_rule",label:"停止调度规则",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{class:{"text-error":-1===t.row.pause_rule,"text-success":-1!==t.row.pause_rule}},[e._v(" "+e._s(e.cronList.pause_rules[t.row.pause_rule])+" ")])]}}])}),o("el-table-column",{attrs:{prop:"version",label:"版本",width:"70",align:"center"}}),o("el-table-column",{attrs:{prop:"remark",label:"备注"}}),o("el-table-column",{attrs:{prop:"order_by",label:"排序",width:"70",align:"center"}}),o("el-table-column",{attrs:{prop:"last_schedule",label:"最后调度完成时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.last_schedule)))]}}])}),o("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button-group",{staticClass:"table-operate"},[o("el-button",{attrs:{type:"primary",plain:""},nativeOn:{click:function(o){return o.preventDefault(),e.editRow(t.row)}}},[e._v("编辑")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cronList.handler_jobs.includes(t.row.api_module),expression:"cronList.handler_jobs.includes(scope.row.api_module)"}],attrs:{plain:""},nativeOn:{click:function(o){return o.preventDefault(),e.scheduleRow(t.row)}}},[e._v("调度 ")])],1)]}}])})],1)],1),o("cron-update",{ref:"cronUpdate",attrs:{"api-modules":e.cronList.api_modules,"pause-rules":e.cronList.pause_rules},on:{success:e.getCronList}}),o("cron-schedule",{ref:"cronSchedule",attrs:{"api-modules":e.cronList.api_modules,"pause-rules":e.cronList.handler_pause_rules}})],1)},n=[],a=o("2934"),l=o("ed08"),i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("DialogPanel",{attrs:{visible:e.visible,title:"调度规则修改",width:"430px","confirm-text":"保存","confirm-loading":e.loading},on:{confirm:e.confirm,cancel:e.cancel}},[o("el-form",{ref:"jobForm",attrs:{size:"mini","label-width":"120px",rules:e.rules,model:e.jobForm}},[o("el-form-item",{attrs:{label:"调度模块"}},[o("el-input",{attrs:{value:e.ApiModules[e.jobForm.api_module],disabled:""}})],1),o("el-form-item",{attrs:{label:"当前版本"}},[o("el-input",{attrs:{value:e.jobForm.version,disabled:""}})],1),o("el-form-item",{attrs:{label:"下次调度日期",prop:"stat_day"}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1,"picker-options":e.pickerOptions},model:{value:e.jobForm.stat_day,callback:function(t){e.$set(e.jobForm,"stat_day",t)},expression:"jobForm.stat_day"}})],1),o("el-form-item",{attrs:{label:"停止调度规则",prop:"pause_rule"}},[o("el-select",{model:{value:e.jobForm.pause_rule,callback:function(t){e.$set(e.jobForm,"pause_rule",t)},expression:"jobForm.pause_rule"}},e._l(e.PauseRules,(function(e,t){return o("el-option",{key:t,attrs:{label:e,value:Number(t)}})})),1)],1),o("el-form-item",{attrs:{label:"调度周期",prop:"job_schedule"}},[o("el-input",{attrs:{placeholder:"* * * * * [分/时/日/月/周]"},model:{value:e.jobForm.job_schedule,callback:function(t){e.$set(e.jobForm,"job_schedule",t)},expression:"jobForm.job_schedule"}}),o("p",{staticClass:"schedule"},[o("span",{staticClass:"text-error"},[e._v(" * 仅支持 Crontab 表达式和 "),o("code",[e._v("robfig/cron")]),e._v(" 包的规则 ["),o("a",{attrs:{href:"https://cron.qqe2.com/",target:"_blank"}},[e._v("Crontab 参考")]),e._v(","),o("a",{attrs:{href:"https://pkg.go.dev/github.com/robfig/cron",target:"_blank"}},[e._v("包规则参考")]),e._v("] ")])])],1),o("el-form-item",{attrs:{label:"排序",prop:"order_by"}},[o("el-input-number",{attrs:{min:1,max:99},model:{value:e.jobForm.order_by,callback:function(t){e.$set(e.jobForm,"order_by",t)},expression:"jobForm.order_by"}})],1),o("el-form-item",{attrs:{label:"备注",prop:"remark"}},[o("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.jobForm.remark,callback:function(t){e.$set(e.jobForm,"remark",t)},expression:"jobForm.remark"}})],1)],1)],1)},s=[],u=o("d4fd"),c={name:"SettingsCronCreate",components:{DialogPanel:u["a"]},props:{ApiModules:{type:Object,required:!0},PauseRules:{type:Object,required:!0}},data:function(){return{visible:!1,loading:!1,job_id:0,jobForm:{api_module:"",job_schedule:"",order_by:99,pause_rule:0,remark:"",stat_day:"",version:1},rules:{stat_day:{required:!0,message:"调度日期必填"},job_schedule:{required:!0,message:"调度周期必填"},pause_rule:{required:!0,message:"停止调度规则必选"},order_by:{required:!0,message:"排序必填"}},pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]}}},methods:{setDefault:function(e){var t=this;Object(a["j"])(e).then((function(o){t.visible=!0,t.job_id=e,t.jobForm=o.data,t.jobForm.stat_day=Object(l["c"])(t.jobForm.stat_day,"{y}-{m}-{d}")})).catch((function(e){t.$message.error(e)}))},confirm:function(){var e=this;this.$refs.jobForm.validate((function(t){if(!t)return!1;e.loading=!0,Object(a["l"])(e.jobForm,e.job_id).then((function(t){e.loading=!1,e.$message.success("修改成功"),e.$emit("success"),e.cancel()})).catch((function(t){e.loading=!1}))}))},cancel:function(){this.visible=!1}}},d=c,p=(o("68a0"),o("cba8")),m=Object(p["a"])(d,i,s,!1,null,null,null),f=m.exports,b=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("DialogPanel",{attrs:{visible:e.visible,title:"调度任务",width:"430px","confirm-text":"立即调度","confirm-loading":e.loading},on:{confirm:e.confirm,cancel:e.cancel}},[o("el-form",{ref:"jobForm",attrs:{size:"mini","label-width":"120px",rules:e.rules,model:e.jobForm}},[o("el-form-item",{attrs:{label:"调度模块"}},[o("el-input",{attrs:{value:e.ApiModules[e.jobForm.api_module],disabled:""}})],1),o("el-form-item",{attrs:{label:"调度日期",prop:"stat_day"}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1,"picker-options":e.pickerOptions},model:{value:e.jobForm.stat_day,callback:function(t){e.$set(e.jobForm,"stat_day",t)},expression:"jobForm.stat_day"}})],1),o("el-form-item",{attrs:{label:"停止调度规则",prop:"pause_rule"}},[o("el-select",{model:{value:e.jobForm.pause_rule,callback:function(t){e.$set(e.jobForm,"pause_rule",t)},expression:"jobForm.pause_rule"}},e._l(e.PauseRules,(function(e,t){return o("el-option",{key:t,attrs:{label:e,value:Number(t)}})})),1)],1)],1)],1)},_=[],h={name:"SettingsCronSchedule",components:{DialogPanel:u["a"]},props:{ApiModules:{type:Object,required:!0},PauseRules:{type:Object,required:!0}},data:function(){return{visible:!1,loading:!1,jobForm:{api_module:"",pause_rule:0,stat_day:""},rules:{stat_day:{required:!0,message:"调度日期必填"},pause_rule:{required:!0,message:"停止调度规则必选"}},pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]}}},methods:{setDefault:function(e){this.jobForm.api_module=e,this.visible=!0},confirm:function(){var e=this;this.$refs.jobForm.validate((function(t){if(!t)return!1;e.$confirm("此调度可能需要较长时间, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(a["k"])(e.jobForm).then((function(){e.$message.info("后台设置调度成功，刷新列表以最后调度完成时间为准"),e.loading=!1,e.visible=!1})).catch((function(t){e.loading=!1}))})).catch((function(){}))}))},cancel:function(){this.visible=!1}}},g=h,j=Object(p["a"])(g,b,_,!1,null,null,null),v=j.exports,y={name:"Cron",components:{CronUpdate:f,CronSchedule:v},data:function(){return{loadings:{pageLoading:!1},cronList:{list:[],pause_rules:{},handler_pause_rules:{},api_modules:{},handler_jobs:[]}}},computed:{},mounted:function(){this.getCronList()},filters:{timeFormat:function(e,t){return Object(l["c"])(e,t)}},methods:{getCronList:function(){var e=this;this.loadings.pageLoading=!0,Object(a["i"])().then((function(t){e.cronList.list=t.data.list,e.cronList.pause_rules=t.data.pause_rules,e.cronList.api_modules=t.data.api_modules,e.cronList.handler_jobs=t.data.handler_jobs,e.cronList.handler_pause_rules=t.data.handler_pause_rules,e.loadings.pageLoading=!1})).catch((function(){e.loadings.pageLoading=!1}))},editRow:function(e){this.$refs.cronUpdate.setDefault(e.id)},scheduleRow:function(e){this.$refs.cronSchedule.setDefault(e.api_module)}}},w=y,k=Object(p["a"])(w,r,n,!1,null,null,null);t["default"]=k.exports},b9c3:function(e,t,o){"use strict";o("80f8")},d4fd:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{title:e.title,visible:e.visible,width:e.width,"append-to-body":"","modal-append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[e._t("default"),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{loading:e.confirmLoading,icon:"el-icon-close"},on:{click:e.handleCancel}},[e._v("取消")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.confirmText,expression:"confirmText"}],attrs:{type:"primary",icon:"el-icon-check",loading:e.confirmLoading},on:{click:e.handleConfirm}},[e._v(e._s(e.confirmText))]),e._t("operate")],2)],2)},n=[],a={props:{confirmText:{default:"",type:String},title:{default:"",type:String},width:{default:"600px",type:String},confirmLoading:{default:!1,type:Boolean},visible:{default:!1,type:Boolean}},methods:{handleCancel:function(){this.$emit("cancel")},handleConfirm:function(){this.$emit("confirm")}}},l=a,i=(o("b9c3"),o("cba8")),s=Object(i["a"])(l,r,n,!1,null,null,null);t["a"]=s.exports}}]);